extends ../navbar

block content
  .form-dialog-container
    .form-dialog
      .form-dialog-header
      .form-dialog-content
        h1.text-center.mb-4(style="font-size: 1.8rem; font-weight: 600; color: #2e3338;")
          if isEdit
            i.fas.fa-edit.me-2(style="color: #4e73df;")
            | Edit Employee
          else
            i.fas.fa-user-plus.me-2(style="color: #4e73df;")
            | Add New Employee
        
        // Flash messages
        if error && error.length > 0
          - const isDuplicateEmail = error.includes('already registered') || error.includes('Email address');
          .alert(class=isDuplicateEmail ? 'alert-danger alert-dismissible fade show mb-3' : 'alert-danger mb-3', role='alert')
            if isDuplicateEmail
              i.fas.fa-exclamation-triangle.me-2
              strong Duplicate Email Error! 
              br
              = error
              button(type='button', class='btn-close', data-bs-dismiss='alert', aria-label='Close')
            else
              i.fas.fa-exclamation-circle.me-2
              = error
        
        form(action=(isEdit ? `/employee/${employee.id}?_method=PUT` : '/employee'), method='POST', id='employeeForm')
          .form-section
            h6.form-section-title
              i.fas.fa-user.me-2
              | Personal Information
            .form-row
              .form-group-wrapper
                label(for='first_name')
                  span.required-field First Name
                input(type='text' class='form-control' id='first_name' name='first_name' 
                      value=(formData && formData.first_name) || (isEdit && employee && employee.first_name) || ''
                      required
                      minlength='2'
                      pattern='[a-zA-Z\s]+'
                      title='First name should only contain letters and spaces, minimum 2 characters'
                      placeholder='Enter first name')
              .form-group-wrapper
                label(for='last_name')
                  span.required-field Last Name
                input(type='text' class='form-control' id='last_name' name='last_name' 
                      value=(formData && formData.last_name) || (isEdit && employee && employee.last_name) || ''
                      pattern='[a-zA-Z\s]+'
                      placeholder='Enter last name')
            .form-row
              .form-group-wrapper
                label(for='email')
                  span.required-field Email
                input(type='email' class='form-control' id='email' name='email' 
                      value=(formData && formData.email) || (isEdit && employee && employee.email) || ''
                      required
                      maxlength='100'
                      placeholder='Enter email address')
              .form-group-wrapper
                label.form-label
                  i.fas.fa-phone.me-1
                  | Phone
                input.form-control(type='tel', name='phone', 
                      value=(formData && formData.phone) || (isEdit && employee && employee.phone) || '',
                      placeholder='Enter phone number with country code (e.g., +919003381176) or 10 digits',
                      pattern='^(?:\\+\\d{1,3}\\s?)?\\d{10}$',
                      maxlength='14',
                      title='Enter 10 digits or country code + 10 digits (e.g., 9003381176 or +919003381176)')
            .form-row
              .form-group-wrapper
                label(for='employee_id') Employee ID
                input(type='text' class='form-control' id='employee_id' name='employee_id' 
                      value=(formData && formData.employee_id) || (isEdit && employee && employee.employee_id) || ''
                      readonly=isEdit
                      maxlength='20'
                      pattern='[a-zA-Z0-9\s]+',
                      title="Employee ID should only contain letters, numbers, and spaces"
                      placeholder='Will be auto-generated')
          .form-section
            h6.form-section-title
              i.fas.fa-briefcase.me-2
              | Job Information
            .form-row
              .form-group-wrapper
                label(for='position') Position
                input(type='text' class='form-control' id='position' name='position' 
                      value=(formData && formData.position) || (isEdit && employee && employee.position) || ''
                      placeholder='Enter job position')
              .form-group-wrapper
                label(for='department') Department
                input(type='text' class='form-control' id='department' name='department' 
                      value=(formData && formData.department) || (isEdit && employee && employee.department) || ''
                      required
                      pattern='[a-zA-Z\s]+',
                      title='Department should only contain letters and spaces, no numbers allowed'
                      list=departments && departments.length > 0 ? 'departments' : undefined
                      placeholder='Enter department name')
                if departments && departments.length > 0
                  datalist#departments
                    each department in departments
                      option(value=department)
            .form-row
              .form-group-wrapper
                label(for='branch') Branch
                input(type='text' class='form-control' id='branch' name='branch' 
                      value=(formData && formData.branch) || (isEdit && employee && employee.branch) || ''
                      list=branches && branches.length > 0 ? 'branches' : undefined
                      placeholder='Enter branch name')
              .form-group-wrapper
                label(for='hire_date') Hire Date
                - let hireDateValue = '';
                - if (formData && formData.hire_date) {
                -   hireDateValue = formData.hire_date;
                - } else if (isEdit && employee && employee.hire_date) {
                -   hireDateValue = new Date(employee.hire_date).toISOString().split('T')[0];
                - }
                input(type='date' class='form-control' id='hire_date' name='hire_date' value=hireDateValue)
            .form-row
              .form-group-wrapper
                label(for='status')
                  span.required-field Status
                select(class='form-control' id='status' name='status' required)
                  option(value='') Select Status
                  - const statusValue = (formData && formData.status) || (isEdit && employee && employee.status);
                  option(value='active' selected=(statusValue === 'active')) Active
                  option(value='inactive' selected=(statusValue === 'inactive')) Inactive
          .form-section
            h6.form-section-title
              i.fas.fa-sticky-note.me-2
              | Additional Information
            .form-row
              .form-group-wrapper.full-width
                label(for='notes') Notes
                textarea(class='form-control' id='notes' name='notes' rows='4' 
                      placeholder='Enter any additional notes or comments')
                  = (formData && formData.notes) || (isEdit && employee && employee.notes) || ''
          .form-dialog-footer
            a.form-action-btn.form-action-btn-secondary(href='/employee')
              i.fas.fa-times
              | Cancel
            if isEdit
              a.form-action-btn.form-action-btn-secondary(href='/employee/#{employee.id}')
                i.fas.fa-eye
                | View
            button.form-action-btn.form-action-btn-primary(type='submit')
              i.fas.fa-save
              = isEdit ? 'Update Employee' : 'Add Employee'
    
    script.
      // Function to handle branch field - show only one branch (works for both create and edit)
      function formatBranchDisplay() {
        const branchInput = document.getElementById('branch');
        if (branchInput) {
          branchInput.addEventListener('blur', function() {
            let value = this.value.trim();
            if (value && value.includes(',')) {
              // Take only the first branch, trim spaces
              const firstBranch = value.split(',')[0].trim();
              this.value = firstBranch;
            }
          });
        }
      }
      
      // Initialize on page load (works for both create and edit)
      document.addEventListener('DOMContentLoaded', function() {
        formatBranchDisplay();
      });