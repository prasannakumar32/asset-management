extends ../navbar

block content
  .container-fluid.px-4.py-4
    .row.mb-4
      .col-12
        h1.text-center.mb-4
          if isEdit
            i.fas.fa-edit.me-2
            | Edit Employee
          else
            i.fas.fa-user-plus.me-2
            | Add New Employee
    
    .row.justify-content-center
      .col-lg-9.col-md-9
        .card.shadow
          .card-header
          
          .card-body
            .row.mb-3
              .col-12
                .d-flex.justify-content-start
                  a(href='/employee' class='btn btn-outline-primary btn-sm')
                    i.fas.fa-arrow-left.me-2
                    | Back to Employees
            
            if error
              .alert.alert-danger(role='alert')
                i.fas.fa-exclamation-triangle.me-2
                = error
            
            if success
              .alert.alert-success(role='alert')
                i.fas.fa-check-circle.me-2
                = success
                
            form(action=(isEdit ? `/employee/${employee.id}?_method=PUT` : '/employee'), method='POST', id='employeeForm', novalidate, class='form-container')
              .row.mb-3
                .col-md-6
                  .form-group.mb-3
                    label(for='first_name' class='form-label required-field')
                      i.fas.fa-user.me-2
                      | First Name
                    input(type='text' class='form-control' id='first_name' name='first_name' 
                          value=(isEdit ? (employee && employee.first_name) || (formData && formData.first_name) || '' : (formData && formData.first_name) || '')
                          required
                          placeholder='Enter first name')
                    .invalid-feedback Please provide a first name.
                
                .col-md-6
                  .form-group.mb-3
                    label(for='last_name' class='form-label required-field')
                      i.fas.fa-user.me-2
                      | Last Name
                    input(type='text' class='form-control' id='last_name' name='last_name' 
                          value=(isEdit ? (employee && employee.last_name) || (formData && formData.last_name) || '' : (formData && formData.last_name) || '')
                          required
                          placeholder='Enter last name')
                    .invalid-feedback Please provide a last name.
              
              .row.mb-3
                .col-md-6
                  .form-group.mb-3
                    label(for='email' class='form-label required-field')
                      i.fas.fa-envelope.me-2
                      | Email
                    .input-group
                      input(type='email' class='form-control' id='email' name='email' 
                            value=(isEdit ? (employee && employee.email) || (formData && formData.email) || '' : (formData && formData.email) || '')
                            required
                            placeholder='Enter email address')
                    .invalid-feedback Please provide a valid email address.
                .col-md-6
                  .form-group.mb-3
                    label(for='phone' class='form-label')
                      i.fas.fa-phone.me-2
                      | Phone
                    .input-group
                      input(type='tel' class='form-control' id='phone' name='phone' 
                            value=(isEdit ? (employee && employee.phone) || (formData && formData.phone) || '' : (formData && formData.phone) || '')
                            placeholder='Enter phone number')
              .row.mb-3
                .col-md-6
                  .form-group.mb-3
                    label(for='employee_id' class='form-label')
                      i.fas.fa-id-badge.me-2
                      | Employee ID
                      if isEdit
                        small.text-muted (Cannot be modified)
                    input(type='text' class='form-control' id='employee_id' name='employee_id' 
                          value=(isEdit ? (employee && employee.employee_id) || (formData && formData.employee_id) || '' : (formData && formData.employee_id) || '')
                          readonly=isEdit
                          placeholder='Will be auto-generated')
                    if isEdit
                      .form-text.text-muted Employee ID cannot be changed after creation
                
                .col-md-6
                  .form-group.mb-3
                    label(for='department' class='form-label required-field')
                      i.fas.fa-building.me-2
                      | Department
                    select(class='form-select' id='department' name='department' required)
                      option(value='') Select Department
                      if departments && departments.length > 0
                        each dept in departments
                          - const isSelected = (isEdit && employee && employee.department === dept) || (formData && formData.department === dept);
                          option(value=dept selected=isSelected)= dept
                    .invalid-feedback Please select a department.
              
              .row.mb-3
                .col-md-6
                  .form-group.mb-3
                    label(for='position' class='form-label required-field')
                      i.fas.fa-briefcase.me-2
                      | Position
                    input(type='text' class='form-control' id='position' name='position' 
                          value=(isEdit ? (employee && employee.position) || (formData && formData.position) || '' : (formData && formData.position) || '')
                          required
                          placeholder='Enter job position')
                    .invalid-feedback Please provide a job position.
                
                .col-md-6
                  .form-group.mb-3
                    label(for='branch' class='form-label')
                      i.fas.fa-map-marker-alt.me-2
                      | Branch
                    select(class='form-select' id='branch' name='branch')
                      option(value='') Select Branch
                      if branches && branches.length > 0
                        each branch in branches
                          - const isSelected = (isEdit && employee && employee.branch === branch) || (formData && formData.branch === branch);
                          option(value=branch selected=isSelected)= branch
              
              .row.mb-3
                .col-md-6
                  .form-group.mb-3
                    label(for='status' class='form-label required-field')
                      i.fas.fa-info-circle.me-2
                      | Status
                    select(class='form-select' id='status' name='status' required)
                      option(value='') Select Status
                      - const statusValue = isEdit ? ((employee && employee.status) || (formData && formData.status)) : (formData && formData.status);
                      option(value='active' selected=(statusValue === 'active')) Active
                      option(value='inactive' selected=(statusValue === 'inactive')) Inactive
                    .invalid-feedback Please select a status.
                
                .col-md-6
                  .form-group.mb-3
                    label(for='hire_date' class='form-label')
                      i.fas.fa-calendar-alt.me-2
                      | Hire Date
                    - let hireDateValue = '';
                    - if (isEdit && employee && employee.hire_date) {
                    -   hireDateValue = new Date(employee.hire_date).toISOString().split('T')[0];
                    - } else if (formData && formData.hire_date) {
                    -   hireDateValue = formData.hire_date;
                    - }
                    input(type='date' class='form-control' id='hire_date' name='hire_date' value=hireDateValue)
              
              //- Form Actions
              .row.mt-4
                .col-6
                  a(href='/employee' class='btn btn-secondary')
                    i.fas.fa-times.me-2
                    | Cancel
                .col-6.text-end
                  button(type='submit' class='btn btn-primary')
                    i.fas.fa-save.me-2
                    = isEdit ? 'Update Employee' : 'Add Employee'
