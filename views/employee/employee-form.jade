extends ../navbar

block content
  .form-dialog-container
    .form-dialog
      .form-dialog-header
      .form-dialog-content
        h1.text-center.mb-4(style="font-size: 1.8rem; font-weight: 600; color: #2e3338;")
          if isEdit
            i.fas.fa-edit.me-2(style="color: #4e73df;")
            | Edit Employee
          else
            i.fas.fa-user-plus.me-2(style="color: #4e73df;")
            | Add New Employee
        
        form(action=(isEdit ? `/employee/${employee.id}?_method=PUT` : '/employee'), method='POST', id='employeeForm')
          .form-section
            h6.form-section-title
              i.fas.fa-user.me-2
              | Personal Information
            .form-row
              .form-group-wrapper
                label(for='first_name')
                  span.required-field First Name
                input(type='text' class='form-control' id='first_name' name='first_name' 
                      value=(isEdit ? (employee && employee.first_name) || (formData && formData.first_name) || '' : (formData && formData.first_name) || '')
                      required
                      placeholder='Enter first name')
              .form-group-wrapper
                label(for='last_name')
                  span.required-field Last Name
                input(type='text' class='form-control' id='last_name' name='last_name' 
                      value=(isEdit ? (employee && employee.last_name) || (formData && formData.last_name) || '' : (formData && formData.last_name) || '')
                      required
                      placeholder='Enter last name')
            .form-row
              .form-group-wrapper
                label(for='email')
                  span.required-field Email
                input(type='email' class='form-control' id='email' name='email' 
                      value=(isEdit ? (employee && employee.email) || (formData && formData.email) || '' : (formData && formData.email) || '')
                      required
                      placeholder='Enter email address')
              .form-group-wrapper
                label.form-label
                  i.fas.fa-phone.me-1
                  | Phone
                input.form-control(type='tel', name='phone', value=employee && employee.phone ? employee.phone : '', 
                      placeholder='Enter 10 digits or country code + 10 digits',
                      pattern='^(\+?\d{1,3}[-.\s]?)?\d{10}$',
                      title='Please enter 10 digits or country code followed by 10 digits (e.g., 1234567890 or +11234567890)')
            .form-row
              .form-group-wrapper
                label(for='employee_id') Employee ID
                input(type='text' class='form-control' id='employee_id' name='employee_id' 
                      value=(isEdit ? (employee && employee.employee_id) || (formData && formData.employee_id) || '' : (formData && formData.employee_id) || '')
                      readonly=isEdit
                      pattern="[a-zA-Z0-9\s]+"
                      title="Employee ID should only contain letters, numbers, and spaces"
                      placeholder='Will be auto-generated'
                      class=(error && error.includes('Employee ID already exists') ? 'is-invalid' : ''))
                if error && error.includes('Employee ID already exists')
                  .invalid-feedback
                    = error
          .form-section
            h6.form-section-title
              i.fas.fa-briefcase.me-2
              | Job Information
            .form-row
              .form-group-wrapper
                label(for='position') Position
                input(type='text' class='form-control' id='position' name='position' 
                      value=(isEdit ? (employee && employee.position) || (formData && formData.position) || '' : (formData && formData.position) || '')
                      placeholder='Enter job position')
              .form-group-wrapper
                label(for='department')
                  span.required-field Department
                select(class='form-control' id='department' name='department' required)
                  option(value='') Select Department
                  if departments && departments.length > 0
                    each dept in departments
                      - const isSelected = (isEdit && employee && employee.department === dept) || (formData && formData.department === dept);
                      option(value=dept selected=isSelected)= dept
            .form-row
              .form-group-wrapper
                label(for='branch') Branch
                select(class='form-control' id='branch' name='branch')
                  option(value='') Select Branch
                  if branches && branches.length > 0
                    each branch in branches
                      - const isSelected = (isEdit && employee && employee.branch === branch) || (formData && formData.branch === branch);
                      option(value=branch selected=isSelected)= branch
              .form-group-wrapper
                label(for='hire_date') Hire Date
                - let hireDateValue = '';
                - if (isEdit && employee && employee.hire_date) {
                -   hireDateValue = new Date(employee.hire_date).toISOString().split('T')[0];
                - } else if (formData && formData.hire_date) {
                -   hireDateValue = formData.hire_date;
                - }
                input(type='date' class='form-control' id='hire_date' name='hire_date' value=hireDateValue)
            .form-row
              .form-group-wrapper
                label(for='status')
                  span.required-field Status
                select(class='form-control' id='status' name='status' required)
                  option(value='') Select Status
                  - const statusValue = isEdit ? ((employee && employee.status) || (formData && formData.status)) : (formData && formData.status);
                  option(value='active' selected=(statusValue === 'active')) Active
                  option(value='inactive' selected=(statusValue === 'inactive')) Inactive
          .form-section
            h6.form-section-title
              i.fas.fa-sticky-note.me-2
              | Additional Information
            .form-row
              .form-group-wrapper.full-width
                label(for='notes') Notes
                textarea(class='form-control' id='notes' name='notes' rows='4' 
                      placeholder='Enter any additional notes or comments')
                  = isEdit ? (employee && employee.notes) || (formData && formData.notes) || '' : (formData && formData.notes) || ''
          .form-dialog-footer
            a.form-action-btn.form-action-btn-secondary(href='/employee')
              i.fas.fa-times
              | Cancel
            if isEdit
              a.form-action-btn.form-action-btn-secondary(href='/employee/#{employee.id}')
                i.fas.fa-eye
                | View
            button.form-action-btn.form-action-btn-primary(type='submit')
              i.fas.fa-save
              = isEdit ? 'Update Employee' : 'Add Employee'