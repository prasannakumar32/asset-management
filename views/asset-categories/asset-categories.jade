extends ../navbar

block content
  .container-fluid.px-4.py-4.asset-category-page-container
    .row.mb-4.asset-category-page-row
      .col-12
        h1.text-center.mb-4.asset-category-page-header Asset Categories
    .row.mb-4.asset-category-actions-row
      .col-12
        .d-flex.justify-content-end.align-items-center.gap-2.asset-category-actions
          a.btn.btn-primary.shadow.btn-sm(href='/asset-categories/form')
            i.fas.fa-plus.me-2
            | Add New Category
          button.btn.btn-info.shadow.btn-sm.ms-2(type='button', onclick='clearAllFilters()')
            i.fas.fa-filter-circle-xmark.me-2
            | Clear Filters
    
    script.
      document.addEventListener('DOMContentLoaded', function() {
        loadCategories();
        
        // Auto submit for filters 
        const statusSelect = document.getElementById('status');
        
        // Helper function
        function addFilterListener(element, callback) {
          if (element) {
            element.addEventListener('change', callback);
          }
        }

        // Add event listeners for filter controls
        addFilterListener(statusSelect, loadCategories);
      });
      
      // Load categories
      function loadCategories() {
        const status = document.getElementById('status')?.value || '';
        
        const params = new URLSearchParams({ status });
        
        fetch(`/api/asset-categories?${params}`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              updateCategoryTable(data.data.categories);
            } else {
              console.error('Error loading categories:', data.error);
            }
          })
          .catch(error => {
            console.error('Error loading categories:', error);
          });
      }
      
      // Update category table with new data
      function updateCategoryTable(categories) {
        const tbody = document.querySelector('tbody');
        if (!tbody) return;
        
        tbody.innerHTML = '';
        
        categories.forEach(category => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="name-td">
              <span>${category.name}</span>
            </td>
            <td class="description-td">
              <span>${category.description || 'No description'}</span>
            </td>
            <td class="status-td">
              <span class="badge ${category.is_active ? 'bg-success' : 'bg-danger'}">${category.is_active ? 'Active' : 'Inactive'}</span>
            </td>
            <td class="created-td">
              <span>${category.created_at ? new Date(category.created_at).toLocaleDateString('en-IN', { year: 'numeric', month: '2-digit', day: '2-digit' }) : 'N/A'}</span>
            </td>
            <td class="actions-td">
              <div class="btn-group btn-group-sm" role="group">
                <a href="/asset-categories/${category.id}/form" class="btn btn-outline-primary action-btn" title="Edit Category">
                  <i class="fas fa-edit"></i>
                </a>
                <a href="/asset-categories/${category.id}/view" class="btn btn-outline-info action-btn" title="View Category Details">
                  <i class="fas fa-eye"></i>
                </a>
                <button class="delete-btn btn btn-outline-danger" type="button" onclick="confirmDelete(${category.id}, '${category.name}')" title="Delete Category">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          `;
          tbody.appendChild(row);
        });
      }
      
      // Clear all filters function
      function clearAllFilters() {
        const status = document.getElementById('status');
        if (status) status.value = '';
        loadCategories();
      }
      
      // Delete confirmation 
      function confirmDelete(categoryId, categoryName) {
        if (confirm('Are you sure you want to delete "' + categoryName + '"? This action cannot be undone.')) {
          fetch(`/api/asset-categories/${categoryId}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.success || data.redirect) {
              loadCategories(); // Reload the categories table
            } else {
              console.error('Error deleting category:', data.error);
            }
          })
          .catch(error => {
            console.error('Error deleting category:', error);
          });
        }
      }
    .row.asset-category-list-row
      .col-12
        .card
          .card-header.mb-3
            .d-flex.justify-content-between.align-items-center
              h5.mb-0.card-title
                i.fas.fa-list.me-2
                | Category List
              .ms-auto
                form.d-flex.align-items-end.justify-content-end.gap-3(method='GET', action='/asset-categories')#filterForm
                  .filter-form-group
                    label.form-label.mb-0.fs-sm.text-muted(for='status') Status
                    select.form-select.form-select-sm(name='status', id='status')
                      option(value='', selected=!status) All
                      option(value='active', selected=status === 'active') Active
                      option(value='inactive', selected=status === 'inactive') Inactive
          .card-body.pt-3
            .table-responsive
              table.table.table-hover.mb-0.table.mt-3
                thead
                  tr
                    th.name-col Name
                    th.description-col Description
                    th.status-col Status
                    th.created-col Created Date
                    th.actions-col Actions
                tbody