extends ../navbar

block content
  .container-fluid.px-4.py-4.asset-category-page-container
    .row.mb-4.asset-category-page-row
      .col-12
        h1.text-center.mb-4.asset-category-page-header Asset Categories
    .row.mb-4.asset-category-actions-row
      .col-12
        .d-flex.justify-content-end.align-items-center.gap-2.asset-category-actions
          a.btn.btn-primary.shadow.btn-sm(href='/asset-categories/form')
            i.fas.fa-plus.me-2
            | Add New Category
          if status
            button.btn.btn-info.shadow.btn-sm(type='button', onclick='clearAllFilters()')
              i.fas.fa-filter-circle-xmark.me-2
              | Clear Filters
    
    script.
      // Wait for DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Auto submit for filters
        const filterForm = document.getElementById('filterForm');
        const statusSelect = document.getElementById('status');
        
        // Helper function to add event listener if element exists
        function addFilterListener(element, callback) {
          if (element) {
            element.addEventListener('change', callback);
          }
        }
        // Add event listeners for filter controls
        if (filterForm) {
          if (statusSelect) addFilterListener(statusSelect, () => filterForm.submit());
        }
      });
      // Delete confirmation 
      function confirmDelete(categoryId, categoryName) {
        if (confirm('Are you sure you want to delete "' + categoryName + '"? This action cannot be undone.')) {
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = '/asset-categories/' + categoryId + '/delete';
          document.body.appendChild(form);
          form.submit();
        }
      }
      // Clear all filters function
      function clearAllFilters() {
        const status = document.getElementById('status');
        
        if (status) status.value = '';
        window.location.href = '/asset-categories';
      }
    .row.asset-category-list-row
      .col-12
        .card
          .card-header.mb-3
            .d-flex.justify-content-between.align-items-center
              h5.mb-0.card-title
                i.fas.fa-list.me-2
                | Category List
              .ms-auto
                form.d-flex.align-items-end.justify-content-end.gap-3(method='GET', action='/asset-categories')#filterForm
                  .filter-form-group
                    label.form-label.mb-0.fs-sm.text-muted(for='status') Status
                    select.form-select.form-select-sm(name='status', id='status')
                      option(value='') All
                      option(value='active', selected=status === 'active') Active
                      option(value='inactive', selected=status === 'inactive') Inactive
          .card-body.pt-3
            .table-responsive
              table.table.table-hover.mb-0.table.mt-3
                thead
                  tr
                    th.name-col Name
                    th.description-col Description
                    th.status-col Status
                    th.created-col Created Date
                    th.actions-col Actions
                tbody
                  if categories && Array.isArray(categories) && categories.length > 0
                    each category in categories
                      tr
                        td.name-td
                          span= category.name
                        td.description-td
                          span= category.description || 'No description'
                        td.status-td
                          span.badge(class=category.is_active ? 'bg-success' : 'bg-danger')= category.is_active ? 'Active' : 'Inactive'
                        td.created-td
                          span= category.created_at ? new Date(category.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A'
                        td.actions-td
                          .d-flex.gap-1.justify-content-end
                            a.btn.btn-outline-primary.btn-sm.action-btn(href='/asset-categories/#{category.id}/form' title='Edit Category')
                              i.fas.fa-edit
                            a.btn.btn-outline-info.btn-sm.action-btn(href='/asset-categories/#{category.id}/view' title='View Category Details')
                              i.fas.fa-eye
                            button.asset-category-action-btn.asset-btn-danger(type='button', onclick='confirmDelete(#{category.id}, "#{category.name}")' title='Delete Category')
                              i.fas.fa-trash.btn-icon
                  else
                    tr
                      td(colspan='5').text-center.text-muted
                        | No asset categories found.