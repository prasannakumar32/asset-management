extends ../navbar

block content
  .container-fluid.px-4.py-4.asset-page-container
    .row.mb-4.asset-page-row
      .col-12
        h1.text-center.mb-4.asset-page-header Asset Inventory
    
    .row.mb-4.asset-actions-row
      .col-12
        .asset-actions
          a.btn.btn-primary.shadow(href='/assets/form')
            i.fas.fa-plus.me-2
            | Add New Asset
          a.btn.btn-success.shadow(href='/asset-assignments/issue')
            i.fas.fa-hand-holding-box.me-2
            | Issue Asset
          a.btn.btn-warning.shadow(href='/asset-assignments/return')
            i.fas.fa-undo.me-2
            | Return Asset
          a.btn.btn-danger.shadow(href='/asset-assignments/scrap')
            i.fas.fa-trash.me-2
            | Scrap Asset
    
    // Search and Filters
    .row.mb-4.search-filters-row
      .col-12
        .card
          .card-body
            form(method='GET', action='/assets').search-form#searchForm
              .search-form-group.search-field
                label.search-form-label(for='search') Search Assets
                input.search-form-control(type='text', name='search', id='search', 
                  value=search || '', 
                  placeholder='Search by name, tag, serial...')
              .search-form-group.filter-field
                label.search-form-label(for='category') Category
                select.search-form-select(name='category', id='category')
                  option(value='') All Categories
                  if categories && categories.length > 0
                    each cat in categories
                      option(value=cat.id, selected=cat.id.toString() === (category || '').toString()) #{cat.name}
              .search-form-group.filter-field
                label.search-form-label(for='status') Status
                select.search-form-select(name='status', id='status')
                  option(value='') All Status
                  option(value='available', selected=status === 'available') Available
                  option(value='assigned', selected=status === 'assigned') Assigned
                  option(value='maintenance', selected=status === 'maintenance') Maintenance
                  option(value='retired', selected=status === 'retired') Retired
              .search-form-group.button-field
                .search-button-group
                  if search || category || status
                    button.search-button.search-button-secondary(type='button', onclick='window.location.href="/assets"')
                      i.fas.fa-times.me-2
                      | Clear
    
    script.
      
      // Auto-submit form when dropdown values change
      document.getElementById('category').addEventListener('change', function() {
        document.getElementById('searchForm').submit();
      });
      
      document.getElementById('status').addEventListener('change', function() {
        document.getElementById('searchForm').submit();
      });
      
      // Handle search input with debounce
      let searchTimeout;
      document.getElementById('search').addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(function() {
          document.getElementById('searchForm').submit();
        }, 500);
      });
    
    // Asset List
    .row.asset-list-row
      .col-12
        .card
          .card-header.mb-3
            h5.mb-0.asset-card-title
              i.fas.fa-list.me-2
              | Asset List
          .card-body.pt-3
            if assets && assets.length > 0
                table.table.table-hover.mb-0.asset-table.mt-3
                  thead
                    tr
                      th.name-col Name
                      th.category-col Category
                      th.serial-col Serial Number
                      th.status-col Status
                      th.assigned-col Assigned To
                      th.actions-col Actions
                  tbody
                    each asset in assets
                      tr
                        td.name-td
                          span= asset.name
                        td.category-td
                          if asset.category
                            span= asset.category.name
                          else
                            span.text-muted N/A
                        td.serial-td
                          span= asset.serial_number || 'N/A'
                        td.status-td
                          - var statusClass = asset.status === 'assigned' ? 'assigned' : asset.status === 'available' ? 'available' : asset.status === 'maintenance' ? 'maintenance' : asset.status === 'retired' ? 'retired' : 'secondary'
                            = asset.status
                        td.assigned-td
                          .d-flex.align-items-center
                            if asset.status === 'assigned' && asset.assignments && asset.assignments.length > 0 && asset.assignments[0] && asset.assignments[0].employee
                              span= asset.assignments[0].employee.first_name + ' ' + asset.assignments[0].employee.last_name
                            else if asset.status === 'assigned'
                              | Assigned
                            else
                              | Unassigned
                        td.actions-td
                          .btn-group.btn-group-sm(role='group')
                            a.btn.btn-outline-primary.action-btn(href='/assets/#{asset.id}/form' title='Edit Asset')
                              i.fas.fa-edit
                            a.btn.btn-outline-info.action-btn(href='/assets/#{asset.id}' title='View Asset Details')
                              i.fas.fa-eye
    
          // Pagination Controls
          if pagination && pagination.totalPages > 1
            .d-flex.justify-content-between.align-items-center.mt-4
              .text-muted
                | Showing 
                span= Math.min((pagination.currentPage - 1) * pagination.itemsPerPage + 1, pagination.totalItems)
                |  to 
                span= Math.min(pagination.currentPage * pagination.itemsPerPage, pagination.totalItems)
                |  of 
                span= pagination.totalItems
                |  assets
              .pagination-controls
                nav
                  ul.pagination.mb-0
                    // Previous button
                    if pagination.currentPage > 1
                      li.page-item
                        a.page-link(href=pagination.urls.prev)
                          i.fas.fa-chevron-left
                          | Previous
                    else
                      li.page-item.disabled
                        span.page-link
                          i.fas.fa-chevron-left
                          | Previous
                    
                    // Page numbers
                    - var startPage = pagination.startPage;
                    - var endPage = pagination.endPage;
                    if startPage > 1
                      li.page-item
                        a.page-link(href=pagination.urls.first) 1
                      if startPage > 2
                        li.page-item.disabled
                          span.page-link ...
                    
                    - for (var i = startPage; i <= endPage; i++)
                      if i === pagination.currentPage
                        li.page-item.active
                          span.page-link= i
                      else
                        li.page-item
                          a.page-link(href=pagination.pageUrls[i])= i
                    
                    if endPage < pagination.totalPages
                      if endPage < pagination.totalPages - 1
                        li.page-item.disabled
                          span.page-link ...
                      li.page-item
                        a.page-link(href=pagination.urls.last)= pagination.totalPages
                    
                    // Next button
                    if pagination.currentPage < pagination.totalPages
                      li.page-item
                        a.page-link(href=pagination.urls.next)
                          | Next
                          i.fas.fa-chevron-right
                    else
                      li.page-item.disabled
                        span.page-link
                          | Next
                          i.fas.fa-chevron-right
