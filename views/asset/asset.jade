extends ../navbar

block content
  .container-fluid.px-4.py-4.asset-page-container
    .row.mb-4.asset-page-row
      .col-12
        h1.text-center.mb-4.asset-page-header Asset Inventory
    
    .row.mb-4.asset-actions-row
      .col-12
        .asset-actions
          a.btn.btn-primary.shadow(href='/assets/form')
            i.fas.fa-plus.me-2
            | Add New Asset
          a.btn.btn-success.shadow(href='/asset-assignment/issue')
            i.fas.fa-hand-holding-box.me-2
            | Issue Asset
          a.btn.btn-warning.shadow(href='/asset-assignment/return')
            i.fas.fa-undo.me-2
            | Return Asset
          a.btn.btn-danger.shadow(href='/asset-assignment/scrap')
            i.fas.fa-trash.me-2
            | Scrap Asset
          if category || status || is_active
            button.btn.btn-info.shadow.ms-2(type='button', onclick='clearAllFilters()')
              i.fas.fa-filter-circle-xmark.me-2
              | Clear Filters
    
    script.
      // Wait for DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Auto submit for filters
        const filterForm = document.getElementById('filterForm');
        const categorySelect = document.getElementById('category');
        const statusSelect = document.getElementById('status');
        const isActiveSelect = document.getElementById('is_active');
        
        // Helper function to add event listener if element exists
        function addFilterListener(element, callback) {
          if (element) {
            element.addEventListener('change', callback);
          }
        }

        // Add event listeners for filter controls
        const branchSelect = document.getElementById('branch');
        addFilterListener(categorySelect, () => filterForm && filterForm.submit());
        addFilterListener(statusSelect, () => filterForm && filterForm.submit());
        addFilterListener(isActiveSelect, () => filterForm && filterForm.submit());
        addFilterListener(branchSelect, () => filterForm && filterForm.submit());
      });
      // Delete confirmation 
      function confirmDelete(assetId, assetName) {
        if (confirm('Are you sure you want to delete "' + assetName + '"? This action cannot be undone.')) {
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = '/assets/' + assetId + '/delete';
          document.body.appendChild(form);
          form.submit();
        }
      }
      
      // Clear all filters function
      function clearAllFilters() {
        document.getElementById('category').value = '';
        document.getElementById('status').value = '';
        document.getElementById('is_active').value = '';
        document.getElementById('branch').value = '';
        window.location.href = '/assets';
      }
    .row.asset-list-row
      .col-12
        .card
          .card-header.mb-3
            .d-flex.justify-content-between.align-items-center
              h5.mb-0.asset-card-title
                i.fas.fa-list.me-2
                | Asset List
              .ms-auto
                form.d-flex.align-items-end.justify-content-end.gap-3(method='GET', action='/assets')#filterForm
                  .filter-form-group
                    label.form-label.mb-0.fs-sm.text-muted(for='category') Category
                    select.form-select.form-select-sm(name='category', id='category')
                      option(value='') All
                      if categories && categories.length > 0
                        each cat in categories
                          option(value=cat.id, selected=cat.id.toString() === (category || '').toString()) #{cat.name}
                  .filter-form-group
                    label.form-label.mb-0.fs-sm.text-muted(for='status') Status
                    select.form-select.form-select-sm(name='status', id='status')
                      option(value='') All
                      option(value='available', selected=status === 'available') Available
                      option(value='assigned', selected=status === 'assigned') Assigned
                      option(value='maintenance', selected=status === 'maintenance') Maintenance
                      option(value='retired', selected=status === 'retired') Retired
                      option(value='scrapped', selected=status === 'scrapped') Scrapped
                  .filter-form-group
                    label.form-label.mb-0.fs-sm.text-muted(for='is_active') Active
                    select.form-select.form-select-sm(name='is_active', id='is_active')
                      option(value='') All
                      option(value='true', selected=is_active === 'true') Active
                      option(value='false', selected=is_active === 'false') Inactive
                  .filter-form-group
                    label.form-label.mb-0.fs-sm.text-muted(for='branch') Branch
                    select.form-select.form-select-sm(name='branch', id='branch')
                      option(value='') All
                      if branches && branches.length > 0
                        each b in branches
                          option(value=b, selected=branch === b)= b
          .card-body.pt-3
                table.table.table-hover.mb-0.asset-table.mt-3
                  thead
                    tr
                      th.name-col Name
                      th.category-col Category
                      th.serial-col Serial Number
                      th.status-col Status
                      th.assigned-col Assigned To
                      th.actions-col Actions
                  tbody
                    each asset in assets
                      tr
                        td.name-td
                          span= asset.name
                        td.category-td
                          if asset.category
                            span= asset.category.name
                          else
                            span.text-muted N/A
                        td.serial-td
                          span= asset.serial_number || 'N/A'
                        td.status-td
                          = asset.status
                        td.assigned-td
                          .d-flex.align-items-center
                            if asset.status === 'assigned' && asset.assignments && asset.assignments.length > 0 && asset.assignments[0] && asset.assignments[0].employee
                              span= asset.assignments[0].employee.first_name + ' ' + asset.assignments[0].employee.last_name
                            else if asset.status === 'assigned'
                              | Assigned
                            else
                              | Unassigned
                        td.actions-td
                          .btn-group.btn-group-sm(role='group')
                            a.btn.btn-outline-primary.action-btn(href='/assets/#{asset.id}/form' title='Edit Asset')
                              i.fas.fa-edit
                            a.btn.btn-outline-info.action-btn(href='/assets/#{asset.id}' title='View Asset Details')
                              i.fas.fa-eye
                            button.asset-action-btn.asset-btn-danger(type='button', onclick='confirmDelete(#{asset.id}, "#{asset.name}")' title='Delete Asset')
                              i.fas.fa-trash.btn-icon
