extends ../navbar

block content
  .container-fluid.px-4.py-4.asset-page-container
    .row.mb-4.asset-page-row
      .col-12
        h1.text-center.mb-4.asset-page-header Asset Inventory
    
    .row.mb-4.asset-actions-row
      .col-12
        .asset-actions
          a.btn.btn-primary.shadow(href='/assets/form')
            i.fas.fa-plus.me-2
            | Add New Asset
          a.btn.btn-success.shadow(href='/asset-assignments/issue')
            i.fas.fa-hand-holding-box.me-2
            | Issue Asset
          a.btn.btn-warning.shadow(href='/asset-assignments/return')
            i.fas.fa-undo.me-2
            | Return Asset
          a.btn.btn-danger.shadow(href='/asset-assignments/scrap')
            i.fas.fa-trash.me-2
            | Scrap Asset
    
    // Search and Filters
    .row.mb-4.search-filters-row
      .col-12
        .card.shadow-sm
          .card-body.p-3
            form(method='GET', action='/assets').search-form#searchForm
              .row.gy-3.gx-4.search-form-vertical
                .col-md-6.col-lg-3
                  .search-form-group.search-field.search-field-main
                    label.search-form-label(for='search') Search Assets
                    input.search-form-control.form-control(type='text', name='search', id='search', 
                      value=search || '', 
                      placeholder='Search by name, tag, serial...')
                .col-md-6.col-lg-3
                  .search-form-group.filter-field.filter-field-category
                    label.search-form-label(for='category') Category
                    select.search-form-select.form-select(name='category', id='category')
                      option(value='') All Categories
                      if categories && categories.length > 0
                        each cat in categories
                          option(value=cat.id, selected=cat.id.toString() === (category || '').toString()) #{cat.name}
                .col-md-6.col-lg-3
                  .search-form-group.filter-field.filter-field-status
                    label.search-form-label(for='status') Status
                    select.search-form-select.form-select(name='status', id='status')
                      option(value='') All Status
                      option(value='available', selected=status === 'available') Available
                      option(value='assigned', selected=status === 'assigned') Assigned
                      option(value='maintenance', selected=status === 'maintenance') Maintenance
                      option(value='retired', selected=status === 'retired') Retired
                // Active status filter removed
                .col-md-6.col-lg-3
                  .search-form-group.filter-field.filter-field-branch
                    label.search-form-label(for='branch') Branch
                    input.search-form-control.form-control(type='text', name='branch', id='branch', 
                      value=branch || '', 
                      placeholder='Enter branch')
                .col-md-6.col-lg-3.d-flex.align-items-end
                  .search-form-group.button-field.search-button-field.w-100
                    .search-button-group.search-button-group-main.w-100
                      if search || category || status || branch
                        button.search-button.search-button-secondary.btn.btn-secondary.w-100(type='button', onclick='clearAllFilters()')
                          i.fas.fa-times.me-1
                          | Clear
    
    script.
      //auto submit for filters 
      document.getElementById('category').addEventListener('change', function() {
        document.getElementById('searchForm').submit();
      });
      
      document.getElementById('status').addEventListener('change', function() {
        document.getElementById('searchForm').submit();
      });
      
      // Handle branch input with debounce
      let branchTimeout;
      document.getElementById('branch').addEventListener('input', function() {
        clearTimeout(branchTimeout);
        branchTimeout = setTimeout(function() {
          document.getElementById('searchForm').submit();
        }, 500);
      });
      
      // Handle search input
      let searchTimeout;
      document.getElementById('search').addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(function() {
          document.getElementById('searchForm').submit();
        }, 500);
      });
      
      // Delete confirmation 
      function confirmDelete(assetId, assetName) {
        if (confirm('Are you sure you want to delete "' + assetName + '"? This action cannot be undone.')) {
          var form = document.createElement('form');
          form.method = 'POST';
          form.action = '/assets/' + assetId + '/delete';
          document.body.appendChild(form);
          form.submit();
        } else {
        }
      }
      // Clear all filters function
      function clearAllFilters() {
        document.getElementById('search').value = '';
        document.getElementById('category').value = '';
        document.getElementById('status').value = '';
        document.getElementById('branch').value = '';
        window.location.href = '/assets';
      }
    .row.asset-list-row
      .col-12
        .card
          .card-header.mb-3
            h5.mb-0.asset-card-title
              i.fas.fa-list.me-2
              | Asset List
          .card-body.pt-3
                table.table.table-hover.mb-0.asset-table.mt-3
                  thead
                    tr
                      th.name-col Name
                      th.category-col Category
                      th.serial-col Serial Number
                      th.status-col Status
                      th.assigned-col Assigned To
                      th.actions-col Actions
                  tbody
                    each asset in assets
                      tr
                        td.name-td
                          span= asset.name
                        td.category-td
                          if asset.category
                            span= asset.category.name
                          else
                            span.text-muted N/A
                        td.serial-td
                          span= asset.serial_number || 'N/A'
                        td.status-td
                          = asset.status
                        td.assigned-td
                          .d-flex.align-items-center
                            if asset.status === 'assigned' && asset.assignments && asset.assignments.length > 0 && asset.assignments[0] && asset.assignments[0].employee
                              span= asset.assignments[0].employee.first_name + ' ' + asset.assignments[0].employee.last_name
                            else if asset.status === 'assigned'
                              | Assigned
                            else
                              | Unassigned
                        td.actions-td
                          .btn-group.btn-group-sm(role='group')
                            a.btn.btn-outline-primary.action-btn(href='/assets/#{asset.id}/form' title='Edit Asset')
                              i.fas.fa-edit
                            a.btn.btn-outline-info.action-btn(href='/assets/#{asset.id}' title='View Asset Details')
                              i.fas.fa-eye
                            button.asset-action-btn.asset-btn-danger(type='button', onclick='confirmDelete(#{asset.id}, "#{asset.name}")' title='Delete Asset')
                              i.fas.fa-trash.btn-icon
